{% extends 'base.html' %}

{% block content %}
<h1>Participant Details</h1>


<h2>Study: {{ study.title }}</h2>
<h3>Participant ID: {{ participant.id }}</h3>
<p>Email: {{ participant.email }}</p>

<h3>Consents and Data Sources</h3>
{% for consent in consent_info %}
<div>
    <h4>{{ consent.source_type }}
        {% if consent.is_optional %}
            (Optional)
        {% endif %}
    </h4>
    <p><strong>Status:</strong>
        {% if consent.data_source %}
            Consent text accepted on {{ consent.consent_date|date:"Y-m-d H:i" }}
            {% if consent.data_source.status == 'active' %}
                <span style="color: green;">Active</span>
            {% elif consent.data_source.status == 'pending' %}
                <span style="color: orange;">Pending Setup</span>
                <br>Setup is required for this data source.
                {% if consent.data_source.get_setup_url %}
                    <a href="{{ consent.data_source.get_setup_url }}">Go to Setup/OAuth</a>
                {% endif %}
            {% elif consent.data_source.status == 'processing' %}
                <span style="color: orange;">Waiting for data</span>
            {% else %}
                <span style="color: orange;">Inactive</span>
            {% endif %}
        {% elif consent.is_complete %}
            Consent text accepted on {{ consent.consent_date|date:"Y-m-d H:i" }}
            <span style="color: orange;">Data source not linked</span>
        {% else %}
            <span style="color: red;">No consent</span>
        {% endif %}
    </p>

    {% if consent.revocation_date %}
        <p><strong>Withdrawn on:</strong> {{ consent.revocation_date|date:"Y-m-d H:i" }}</p>
    {% endif %}

    {% if consent.data_source %}
        <p><strong>Data Source:</strong> {{ consent.data_source.display_type }}</p>
        <ul>
            <li>Type: {{ consent.data_source.type }}</li>
            <li>Details: {{ consent.data_source.details }}</li>
            <li>Status: {{ consent.data_source.status }}</li>
            <li>Added: {{ consent.data_source.date_added|date:"Y-m-d H:i" }}</li>
        </ul>
    {% else %}
    <p><strong>Data Source:</strong> Not linked yet</p>
    {% endif %}
</div>
<hr>
{% endfor %}

<p><a href="{% url 'researcher_dashboard' %}">Back to Dashboard</a></p>


{% endblock %}